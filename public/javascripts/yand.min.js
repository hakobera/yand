function Yand(){var self=this;self.search=$("#searchField"),self.indexList=$("#indexList"),self.results=$("#results"),self.categories=$(".category",self.indexList),self.keys={enter:13,escape:27,up:38,down:40,left:37,right:39,array:[13,27,37,38,39,40]},self.isMobile=!1}Yand.prototype.init=function(){var self=this;self.initView(),self.bindEvents(),self.mobilify(),self.setupHistory(),self.loadFirstPage()},Yand.prototype.initView=function(){var self=this;self.categories.each(function(){$(this).addClass("close")})},Yand.prototype.bindEvents=function(){var self=this;self.search.keyup(function(event){-1!==$.inArray(event.keyCode,self.keys.array)?self.handleKey(event.keyCode):self.searchIndex()}).on("search",function(){""===$(this).val()&&self.searchIndex()}).focus(),$("a",self.indexList).live("click",function(e){e.preventDefault(),$("li",self.indexList).removeClass("selected"),$(this).parent().addClass("selected"),self.linkOpen($(this))}),$("a",self.results).live("click",function(e){e.preventDefault(),$("li",self.results).removeClass("selected"),$(this).parent().addClass("selected"),self.linkOpen($(this))}),$("span:first",self.categories).toggle(function(){self.listOpen($(this).closest(".category"))},function(){self.listClose($(this).closest(".category"))})},Yand.prototype.mobilify=function(){var self=this,ua=navigator.userAgent;if(-1!==ua.indexOf("Mobile")){self.isMobile=!0;var height=$(parent.window).innerHeight()-30;$("#navigation").css({height:height,"overflow-y":"scroll","overflow-x":"hidden"}),setTimeout(function(){window.parent.scrollTo(0,1)},0)}},Yand.prototype.setupHistory=function(){var self=this;Modernizr.history&&(window.parent.onpopstate=function(event){var href=event.state;href&&self.linkOpen(href,!1)})},Yand.prototype.loadFirstPage=function(){var self=this,loc=window.parent.location,query=loc.search,hash=loc.hash,q=query.match(/\?q=([^&]+)/),p=query.match(/\?p=([^&]+)/);if(q){if(q=decodeURIComponent(q[1]).replace(/\+/g," "),q.length>0){self.search.val(q),self.searchIndex();var links=$("li > a",self.results);links.length>0&&self.linkOpen($(links[0]))}}else p&&p[1]?self.linkOpen(p[1]+hash):self.linkOpen("top.html",!1)},Yand.prototype.handleKey=function(key){var self=this,keys=self.keys;if(self.results.is(":visible")){var selected=$(".selected:visible");selected.length?(key==keys.up&&selected.prev().length&&selected.removeClass("selected").prev().addClass("selected"),key==keys.down&&selected.next().length&&selected.removeClass("selected").next().addClass("selected"),key==keys.enter&&(selected.find("a:first").attr("href"),self.linkOpen(selected.find("a:first"))),key==keys.right&&self.listOpen(selected),key==keys.left&&self.listClose(selected)):key==keys.down&&(selected=$("li:first",results),selected.addClass("selected"))}},Yand.prototype.searchIndex=function(){var self=this,query=self.search.val();query.length?(self.results.html("").show(),self.indexList.hide(),query=query.toLowerCase(),$(".searchable",self.indexList).each(function(){var el=$(this),name=el.text(),pos=name.toLowerCase().indexOf(query);if(-1!=pos&&-1===self.results.text().indexOf(name)){var li=$("<li>");li.append(el.parent().parent().find("a:first").clone()),li.highlight(query),self.results.append(li)}}),$(".selected",self.indexList).removeClass("selected"),$("li:first",self.results).addClass("selected")):(self.results.hide(),self.indexList.show())},Yand.prototype.listOpen=function(li){li.removeClass("close").children("ul").show()},Yand.prototype.listClose=function(li){li.addClass("close").children("ul").hide()},Yand.prototype.linkOpen=function(link,saveState){function loadPage(){parent.docwin&&parent.docwin.pageLoad?parent.docwin.pageLoad(href,saveState):setTimeout(loadPage,100)}var href="string"==typeof link?link:link.attr("href"),saveState=void 0!=saveState?saveState:!0;setTimeout(loadPage,0)},$(function(){$("#navigation").load("navigation.html",function(){(new Yand).init()})});